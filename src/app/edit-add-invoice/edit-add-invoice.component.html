<div [class.formdarkmode]="service.isDarkMode" class="container">
  <form [class.formdarkmode]="service.isDarkMode" [formGroup]="invoiceForm">
    <!-- DETAILS STARTS HERE -->

    <div class="details">
      <!-- heading -->
      <ng-container *ngIf="!service.editButtonClicked">
        <!-- goback on  mobile -->
        
          <div class="mobileview" (click)="onDiscard()"   class="backwrapper">
            <!-- back icon svg -->
            <svg
              width="10"
              height="12"
              viewBox="0 0 10 12"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g filter="url(#filter0_d_0_8737)">
                <path
                  d="M4.3418 0.886047L0.113895 5.11395L4.3418 9.34185"
                  stroke="#7C5DFA"
                  stroke-width="2"
                  shape-rendering="crispEdges"
                />
              </g>
              <defs>
                <filter
                  id="filter0_d_0_8737"
                  x="-5.30029"
                  y="0.178955"
                  width="14.3492"
                  height="17.87"
                  filterUnits="userSpaceOnUse"
                  color-interpolation-filters="sRGB"
                >
                  <feFlood flood-opacity="0" result="BackgroundImageFix" />
                  <feColorMatrix
                    in="SourceAlpha"
                    type="matrix"
                    values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                    result="hardAlpha"
                  />
                  <feOffset dy="4" />
                  <feGaussianBlur stdDeviation="2" />
                  <feComposite in2="hardAlpha" operator="out" />
                  <feColorMatrix
                    type="matrix"
                    values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"
                  />
                  <feBlend
                    mode="normal"
                    in2="BackgroundImageFix"
                    result="effect1_dropShadow_0_8737"
                  />
                  <feBlend
                    mode="normal"
                    in="SourceGraphic"
                    in2="effect1_dropShadow_0_8737"
                    result="shape"
                  />
                </filter>
              </defs>
            </svg>
            <!-- back icon svg -->
            <p class="gobacktext" [class.darkmodeText]="service.isDarkMode">Go Back</p>
          </div>
        

        <h1 [class.headingdarkmode]="service.isDarkMode">New Invoice</h1>
      </ng-container>
      <ng-container *ngIf="service.editButtonClicked">
        <h1 [class.headingdarkmode]="service.isDarkMode">
          Edit <span>#</span>{{ invoiceId }}
        </h1>
      </ng-container>

      <!-- sender details -->
      <fieldset formGroupName="senderAddress">
        <div class="senderinfo">
          <p>Bill From</p>
          <!--sender street address -->
          <div class="textinput">
            <label
              [class.labeldarkmode]="service.isDarkMode"
              [ngClass]="{
                invalidText:
                  formSubmitted &&
                  invoiceForm.get('senderAddress.street')?.invalid
              }"
              for="senderstreet"
              >Street Address</label
            >
            <input
              [class.inputdarkmode]="service.isDarkMode"
              [ngClass]="{
                invalid:
                  formSubmitted &&
                  invoiceForm.get('senderAddress.street')?.invalid
              }"
              formControlName="street"
              type="text"
              name=""
              id="senderstreet"
            />
          </div>
          <!-- sender city postal country -->
          <div class="addresses">
            <!-- sender city postal -->
            <div class="citypostal">
              <span>
                <label
                  [class.labeldarkmode]="service.isDarkMode"
                  [ngClass]="{
                    invalidText:
                      formSubmitted &&
                      invoiceForm.get('senderAddress.city')?.invalid
                  }"
                  for="sendercity"
                  >City</label
                >
                <input
                  [class.inputdarkmode]="service.isDarkMode"
                  [ngClass]="{
                    invalid:
                      formSubmitted &&
                      invoiceForm.get('senderAddress.city')?.invalid
                  }"
                  formControlName="city"
                  type="text"
                  name=""
                  id="sendercity"
                />
              </span>
              <span>
                <label
                  [class.labeldarkmode]="service.isDarkMode"
                  [ngClass]="{
                    invalidText:
                      formSubmitted &&
                      invoiceForm.get('senderAddress.postCode')?.invalid
                  }"
                  for="senderpostal"
                  >Postal Code</label
                >
                <input
                  [class.inputdarkmode]="service.isDarkMode"
                  [ngClass]="{
                    invalid:
                      formSubmitted &&
                      invoiceForm.get('senderAddress.postCode')?.invalid
                  }"
                  formControlName="postCode"
                  type="text"
                  name=""
                  id="senderpostal"
                />
              </span>
            </div>
            <!-- sender country -->
            <div class="country">
              <label
                [class.labeldarkmode]="service.isDarkMode"
                [ngClass]="{
                  invalidText:
                    formSubmitted &&
                    invoiceForm.get('senderAddress.country')?.invalid
                }"
                for="sendercountry"
                >Country</label
              >
              <input
                [class.inputdarkmode]="service.isDarkMode"
                [ngClass]="{
                  invalid:
                    formSubmitted &&
                    invoiceForm.get('senderAddress.country')?.invalid
                }"
                formControlName="country"
                type="text"
                name=""
                id="sendercountry"
              />
            </div>
          </div>
        </div>
      </fieldset>

      <!-- receipient details -->

      <div class="receipientinfo">
        <p>Bill To</p>
        <!--clients street address -->
        <div class="textinput">
          <label
            [class.labeldarkmode]="service.isDarkMode"
            [ngClass]="{
              invalidText:
                formSubmitted && invoiceForm.get('clientName')?.invalid
            }"
            for="clientsname"
            >Clients's Name</label
          >
          <input
            [class.inputdarkmode]="service.isDarkMode"
            [ngClass]="{
              invalid: formSubmitted && invoiceForm.get('clientName')?.invalid
            }"
            type="text"
            name=""
            formControlName="clientName"
            id="clientsname"
          />
        </div>
        <div class="textinput">
          <label
            [class.labeldarkmode]="service.isDarkMode"
            [ngClass]="{
              invalidText:
                formSubmitted && invoiceForm.get('clientEmail')?.invalid
            }"
            for="clientemail"
            >Client's Email</label
          >
          <input
            [class.inputdarkmode]="service.isDarkMode"
            [ngClass]="{
              invalid: formSubmitted && invoiceForm.get('clientEmail')?.invalid
            }"
            formControlName="clientEmail"
            type="text"
            name=""
            id="clientemail"
            placeholder="e.g. email@example.com"
          />
        </div>

        <fieldset formGroupName="clientAddress">
          <div class="textinput">
            <label
              [class.labeldarkmode]="service.isDarkMode"
              [ngClass]="{
                invalidText:
                  formSubmitted &&
                  invoiceForm.get('clientAddress.street')?.invalid
              }"
              for="clientstreet"
              >Street Address</label
            >
            <input
              [class.inputdarkmode]="service.isDarkMode"
              [ngClass]="{
                invalid:
                  formSubmitted &&
                  invoiceForm.get('clientAddress.street')?.invalid
              }"
              formControlName="street"
              type="text"
              name=""
              id="clientstreet"
            />
          </div>
          <!-- clientscity postal country -->
          <div class="addresses">
            <!-- clients city postal -->
            <div class="citypostal">
              <span>
                <label
                  [class.labeldarkmode]="service.isDarkMode"
                  [ngClass]="{
                    invalidText:
                      formSubmitted &&
                      invoiceForm.get('clientAddress.city')?.invalid
                  }"
                  for="clientcity"
                  >City</label
                >
                <input
                  [class.inputdarkmode]="service.isDarkMode"
                  [ngClass]="{
                    invalid:
                      formSubmitted &&
                      invoiceForm.get('clientAddress.city')?.invalid
                  }"
                  formControlName="city"
                  type="text"
                  name=""
                  id="clientcity"
                />
              </span>
              <span>
                <label
                  [class.labeldarkmode]="service.isDarkMode"
                  [ngClass]="{
                    invalidText:
                      formSubmitted &&
                      invoiceForm.get('clientAddress.postCode')?.invalid
                  }"
                  for="clientpostal"
                  >Postal Code</label
                >
                <input
                  [class.inputdarkmode]="service.isDarkMode"
                  [ngClass]="{
                    invalid:
                      formSubmitted &&
                      invoiceForm.get('clientAddress.postCode')?.invalid
                  }"
                  formControlName="postCode"
                  type="text"
                  name=""
                  id="clientpostal"
                />
              </span>
            </div>
            <!-- clients country -->
            <div class="country">
              <label
                [class.labeldarkmode]="service.isDarkMode"
                [ngClass]="{
                  invalidText:
                    formSubmitted &&
                    invoiceForm.get('clientAddress.country')?.invalid
                }"
                for="clientcountry"
                >Country</label
              >
              <input
                [class.inputdarkmode]="service.isDarkMode"
                [ngClass]="{
                  invalid:
                    formSubmitted &&
                    invoiceForm.get('senderAddress.country')?.invalid
                }"
                formControlName="country"
                type="text"
                name=""
                id="clientcountry"
              />
            </div>
          </div>
        </fieldset>

        <div class="invoicedatesContainer">
          <div class="invoicedate">
            <label [class.labeldarkmode]="service.isDarkMode" for="invoicedate"
              >Invoice Date</label
            >
            <input
              [class.inputdarkmode]="service.isDarkMode"
              formControlName="createdAt"
              type="date"
              id="invoicedate"
            />
          </div>
          <div class="paymentterms">
            <label [class.labeldarkmode]="service.isDarkMode">
              Payment Terms</label
            >
            <div
              [class.inputdarkmode]="service.isDarkMode"
              class="termscontainer"
            >
              <span
                [class.inputdarkmode]="service.isDarkMode"
                class="termsinputdisplay"
                >{{ termsString }}</span
              >
              <!-- icon -->
              <svg
                width="11"
                height="7"
                viewBox="0 0 11 7"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M1 1L5.2279 5.2279L9.4558 1"
                  stroke="#7C5DFA"
                  stroke-width="2"
                />
              </svg>

              <!-- floating menu -->
              <div [class.inputdarkmode]="service.isDarkMode" class="termsMenu">
                <span (click)="onTermsChange('1')"><p>Net 1 Day</p> </span>
                <span (click)="onTermsChange('7')"><p>Net 7 Days</p></span>
                <span (click)="onTermsChange('14')"><p>Net 14 Days</p></span>
                <span (click)="onTermsChange('30')"><p>Net 30 Days</p></span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- project description -->
      <div class="projectdescription">
        <label
          [class.labeldarkmode]="service.isDarkMode"
          [ngClass]="{
            invalidText:
              formSubmitted && invoiceForm.get('description')?.invalid
          }"
          for="projectdescription"
          >Project Description</label
        >
        <input
          [class.inputdarkmode]="service.isDarkMode"
          [ngClass]="{
            invalid: formSubmitted && invoiceForm.get('description')?.invalid
          }"
          formControlName="description"
          type="text"
          id="projectdescription"
          placeholder="e.g. Graphic Design Service"
        />
      </div>

      <!-- items -->
      <div class="items">
        <p class="itemlist">Item List</p>
        <!--item titles  shown on desktop -->
        <div class="titles">
          <span
            class="item-name normaltext"
            [class.darkmodeTextBold]="service.isDarkMode"
            ><p [class.titlesdarkmode]="service.isDarkMode">Item Name</p></span
          >
          <div class="nestedwrapper">
            <span class="item-quantity">
              <p class="normaltext" [class.titlesdarkmode]="service.isDarkMode">
                Qty.
              </p>
            </span>
            <span class="item-price">
              <p class="normaltext" [class.titlesdarkmode]="service.isDarkMode">
                Price
              </p>
            </span>
            <span class="item-total">
              <p class="normaltext" [class.titlesdarkmode]="service.isDarkMode">
                Total
              </p>
            </span>
          </div>
        </div>
        <!-- items titles shown on desktop ends here -->

        <fieldset formArrayName="items">
          <div
            class="itemcontainer"
            *ngFor="let item of itemsFormArray.controls; let i = index"
            [formGroupName]="i"
          >
            <!-- item name -->
            <div class="item-name">
              <label 
              class="tohide"
                [class.labeldarkmode]="service.isDarkMode"
                for="item-name-{{ i }}"
                >Item Name</label
              >
              <input
                [class.inputdarkmode]="service.isDarkMode"
                [ngClass]="{
                  invalid: formSubmitted && item.get('name')?.invalid
                }"
                formControlName="name"
                type="text"
                id="item-name-{{ i }}"
              />
            </div>
            <!-- item quantity -->
            <div class="item-quantity">
              <label
              class="tohide"
                [class.labeldarkmode]="service.isDarkMode"
                for="item-quantity-{{ i }}"
                >Qty.</label
              >
              <input
                [class.inputdarkmode]="service.isDarkMode"
                formControlName="quantity"
                type="number"
                id="item-quantity-{{ i }}"
              />
            </div>
            <!-- item price -->
            <div class="item-price">
              <label
              class="tohide"
                [class.labeldarkmode]="service.isDarkMode"
                for="item-price-{{ i }}"
                >Price</label
              >
              <input
                [class.inputdarkmode]="service.isDarkMode"
                id="item-price-{{ i }}"
                formControlName="price"
                type="number"
                formControlName="price"
              />
            </div>
            <!-- item total -->
            <div class="item-total">
              <label class="tohide" [class.labeldarkmode]="service.isDarkMode" for="item-total"
                >Total</label
              >
              <input
                [class.inputdarkmode]="service.isDarkMode"
                class="totalinput"
                [value]="
                  (item.get('quantity')?.value || 0) *
                  (item.get('price')?.value || 0)
                "
                formControlName="total"
                readonly
              />
            </div>
            <!-- this  removes items from the form -->
            <div (click)="onRemoveItem(i)" class="remove-item">
              <img src="../../assets/icons/deleteitem.png" alt="remove icon" />
            </div>
          </div>
        </fieldset>

        <!-- this button adds items to the form -->
        <button
          [class.inputdarkmode]="service.isDarkMode"
          class="additem"
          (click)="onAddItem()"
          type="button"
        >
          <span class="plusicon">+</span>
          <p class="additemtext">Add New Item</p>
        </button>
      </div>
    </div>
    <!-- DETAILS ENDS HERE -->

    <!-- form control buttons -->
    <div
      [style.justify-content]="
        service.editButtonClicked ? 'flex-end' : 'space-between'
      "
      class="formcontrolbuttons"
      [class.formdarkmode]="service.isDarkMode"
    >
      <!-- button shows when adding new -->
      <div class="discardwrap" *ngIf="!service.editButtonClicked">
        <button (click)="onDiscard()" class="discard">Discard</button>
      </div>
      <div class="savewrap">
        <!-- buttons show when adding New -->
        <ng-container *ngIf="!service.editButtonClicked">
          <button (click)="onSaveAsDraft()" class="draft" type="submit">
            Save As Draft
          </button>
          <button (click)="onSave()" class="save" type="submit">
            Save & Send
          </button>
        </ng-container>
        <!-- buttons show when editing -->
        <ng-container *ngIf="service.editButtonClicked">
          <button (click)="onDiscard()" class="draft" type="submit">
            Cancel
          </button>
          <button (click)="onSave()" class="save" type="submit">
            Save changes
          </button>
        </ng-container>
      </div>
    </div>
  </form>
</div>
